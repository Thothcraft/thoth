# Nodogsplash Configuration for Thoth Device
# This configuration enables automatic captive portal detection

# The network interface to use for the captive portal
# wlan0 is typically the WiFi interface on Raspberry Pi
GatewayInterface wlan0

# Gateway name - appears in some client notifications
GatewayName "Thoth Device"

# Maximum number of clients allowed to connect
# 0 means unlimited
MaxClients 250

# Session timeout in minutes (0 = no timeout)
# Set to 0 for unlimited access once authenticated
SessionTimeout 0

# Preauthenticated users - these rules apply BEFORE authentication
# Allow access to the Thoth web app and common ports
FirewallRuleSet preauthenticated-users {
    # Allow DNS
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 53
    
    # Allow DHCP
    FirewallRule allow udp port 67
    FirewallRule allow udp port 68
    
    # Allow HTTP and HTTPS to the gateway (for the web app)
    FirewallRule allow tcp port 80
    FirewallRule allow tcp port 443
    
    # Allow access to Flask app on port 5000
    FirewallRule allow tcp port 5000
    
    # Allow ping
    FirewallRule allow icmp
}

# Authenticated users - these rules apply AFTER authentication
# Allow all traffic once authenticated
FirewallRuleSet authenticated-users {
    FirewallRule allow all
}

# Users to authenticate - empty means all users need to authenticate
# For Thoth, we want to show the splash page to everyone
FirewallRuleSet users-to-router {
    FirewallRule allow all
}

# Trusted users - MAC addresses that bypass the captive portal
# Add MAC addresses here if needed, one per line
# FirewallRuleSet trusted-users {
#     FirewallRule allow from 00:11:22:33:44:55
# }

# Splash page settings
# The splash page is served by Nodogsplash's built-in web server

# Redirect URL after splash page (optional)
# Leave commented to use the splash page's own redirect
# RedirectURL http://192.168.4.1:5000/

# Enable the built-in splash page
# The splash page will be served from /etc/nodogsplash/htdocs/splash.html
SplashPage /etc/nodogsplash/htdocs/splash.html

# Gateway address - this is the IP of your Pi on the hotspot network
# Should match your dnsmasq/hostapd configuration
GatewayAddress 10.0.0.1

# Status page - shows connected clients
# StatusPath is not a valid option in this version of nodogsplash
# Status page is available at http://10.0.0.1:2050/nodogsplash_auth/ by default

# Authentication settings
# For automatic redirect without user interaction, we use immediate authentication
# Set to 0 to require user to click a button
# Set to 1 for automatic authentication after splash page loads
# We'll handle the redirect in the splash.html file itself

# Logging level (0-3, 0=silent, 3=verbose)
DebugLevel 1

# Daemon mode - run in background
Daemon 1

# Check interval for client activity (seconds)
CheckInterval 30

# Enable MAC address authentication
# This allows you to whitelist specific devices
# MACMechanism block
# Use "allow" to whitelist, "block" to blacklist
# MACMechanism allow

# Bandwidth limits (optional)
# DownloadLimit 0
# UploadLimit 0
